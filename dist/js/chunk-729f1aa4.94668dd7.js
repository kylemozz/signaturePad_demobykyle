(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-729f1aa4"],{"1ea8":function(t,e,i){},"6c2b":function(t,e,i){"use strict";i("1ea8")},"735b":function(t,e,i){"use strict";i("8edd")},"8edd":function(t,e,i){},a142:function(t,e,i){"use strict";i.r(e);var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"canvas_container"},[i("canvas",{attrs:{id:"canvas"}}),i("a-menu",{staticClass:"canvas-menu",attrs:{mode:"horizontal",selectable:!1,multiple:!0}},[i("a-menu-item",{staticClass:"menu-item"},[i("span",[t._v("粗细：")]),i("a-input",{staticClass:"pen-width-input",on:{blur:function(e){return t.penSizeChange(t.width)}},model:{value:t.width,callback:function(e){t.width=e},expression:"width"}})],1),i("a-menu-item",{staticClass:"menu-item"},[i("a-button",{staticClass:"menu-btn small-width",on:{click:function(e){return t.download()}}},[i("a-icon",{staticClass:"small-margin-right",attrs:{type:"download"}}),i("span",{staticClass:"btn-text"},[t._v("保存")])],1)],1),i("a-menu-item",{staticClass:"menu-item"},[t._v(" 格式： "),i("a-select",{staticClass:"img-type",staticStyle:{width:"70px"},attrs:{"label-in-value":"","default-value":{key:"jpg"}},on:{change:t.imgTypeChange}},[i("a-select-option",{attrs:{value:"png"}},[t._v(" png ")]),i("a-select-option",{attrs:{value:"jpg"}},[t._v(" jpg ")])],1)],1),i("a-menu-item",{staticClass:"menu-item"},[i("a-button",{staticClass:"menu-btn small-width",attrs:{id:"saveCanvas"},on:{click:function(e){return t.clear()}}},[i("a-icon",{staticClass:"small-margin-right",attrs:{type:"delete"}}),i("span",{staticClass:"btn-text"},[t._v("清除")])],1)],1),i("a-menu-item",{staticClass:"menu-item"},[i("a-button",{staticClass:"menu-btn small-width",attrs:{type:t.btnHighlight||t.imgFlag?"primary":""},on:{click:function(e){return t.rePaint()}}},[t._v("重绘")])],1),i("a-menu-item",{staticClass:"menu-item"},[i("a-button",{staticClass:"menu-btn small-width",attrs:{type:t.btnHighlight||t.imgFlag?"primary":""},on:{click:function(e){return t.clearTrace()}}},[t._v("清除重绘")])],1),i("a-menu-item",{staticClass:"menu-item"},[i("a-button",{staticClass:"menu-btn small-width",attrs:{type:t.btnHighlight?"primary":""},on:{click:function(e){return t.saveTraceAsJSON()}}},[t._v("导出重绘")])],1),i("a-menu-item",{staticClass:"menu-item"},[i("a-button",{staticClass:"menu-btn small-width",on:{click:function(e){return t.fileInput()}}},[t._v("导入重绘")]),t._v(" "+t._s(t.file.length>0?t.file[0].name:"none")+" "),i("input",{attrs:{id:"fileInputBtn",type:"file",multiple:""}})],1),i("a-menu-item",{staticClass:"menu-item"},[i("a-button",{staticClass:"menu-btn small-width",on:{click:function(e){return t.imageInput()}}},[t._v("导入图片")]),t._v(" "+t._s(t.image.length>0?t.image[0].name:"none")+" "),i("input",{staticStyle:{display:"none"},attrs:{id:"imageInputBtn",type:"file",multiple:""}})],1),i("a-menu-item",{staticClass:"menu-item"},[i("a-button",{staticClass:"menu-btn small-width",on:{click:function(e){return t.traceBackWard()}}},[t._v("撤回")])],1),i("a-menu-item",{staticClass:"menu-item"},[i("a-button",{staticClass:"menu-btn small-width",attrs:{type:t.eraserFlag?"primary":""},on:{click:function(e){return t.eraserTrigger()}}},[t._v("橡皮擦")])],1),i("a-menu-item",{staticClass:"menu-item"},[i("a-button",{staticClass:"menu-btn small-width",on:{click:function(e){return t.penShape()}}},[t._v("笔锋")])],1),i("a-menu-item",{key:"13",staticClass:"menu-item extra-show-item"},[i("span",[t._v("颜色：")]),i("colorPicker",{staticClass:"colorPicker",on:{change:function(e){return t.colorChange(t.color)}},model:{value:t.color,callback:function(e){t.color=e},expression:"color"}})],1)],1)],1)},a=[],s=(i("a9e3"),i("99af"),i("ac1f"),i("466d"),i("a434"),i("fb6a"),i("d3b7"),i("3ca3"),i("ddb0"),i("2b3d"),{props:{lineWidth:{type:Number,default:5},lineColor:{type:String,default:"#000"},canvasBgColor:{type:String,default:"#fff"},imageType:{type:String,default:"jpg"}},data:function(){return{openKeys2:[],openKeys:[],canvas:"",cxt:"",trace:[],flag:"",btnHighlight:!1,imgFlag:!1,file:"",fileInputBtn:"",imageInputBtn:"",image:"",imageToInsert:"",newTrace:"",eraserFlag:!1,eraserTrace:[],minusX:"",minusY:"",color:this.lineColor,width:this.lineWidth}},watch:{trace:function(){this.trace.length>0?this.btnHighlight=!0:this.btnHighlight=!1},imageToInsert:function(){this.imageToInsert?this.imgFlag=!0:this.imgFlag=!1}},methods:{showMenu:function(){this.openKeys=this.openKeys2},openChange:function(){this.openKeys2=this.openKeys,console.log(this.openKeys)},injectImage:function(t){console.log(t),this.imageToInsert=t,this.drawImageOnCanvas()},injectJSON:function(t){console.log(t),this.newTrace=JSON.parse(t),this.trace=this.trace.concat(this.newTrace)},mobileCompute:function(){this.minusX=this.canvas.getBoundingClientRect().x,this.minusY=this.canvas.getBoundingClientRect().y},isMobile:function(){return!!window.navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i)},penShapeCompute:function(){for(var t=[],e=[],i=0;i<this.trace.length;i++)this.trace[i].end&&t.push(i);e[0]=t[0]+1;for(var n=1;n<t.length;n++)e.push(t[n]-t[n-1]);for(var a=(this.lineWidth-1)/e[0],s=!0,r=0;r<this.trace.length;r++)s?(this.beginAndMove(this.trace[r].x,this.trace[r].y),s=!1):(this.cxt.lineWidth-=a,this.draw(this.trace[r].x,this.trace[r].y),this.trace[r].end&&(s=!0,this.cxt.lineWidth=this.lineWidth,e.shift(),a=(this.lineWidth-1)/e[0]))},penShape:function(){this.clearCanvas(),this.penShapeCompute(),this.image2Canvas(!0)},eraserTheLine:function(){for(var t=0;t<this.trace.length-1;t++)if(!this.trace[t].end){var e=this.eraserTrace[0].x,i=this.eraserTrace[0].y,n=this.eraserTrace[1].x,a=this.eraserTrace[1].y,s=this.trace[t].x,r=this.trace[t].y,c=this.trace[t+1].x,h=this.trace[t+1].y,o=this.judgeIntersect(e,i,n,a,s,r,c,h);o&&this.removeThisLine(t)}},judgeIntersect:function(t,e,i,n,a,s,r,c){var h,o,l,u,d=Math.min(e,n)<=Math.max(s,c),g=Math.min(a,r)<Math.max(t,i),m=Math.min(s,c)<Math.max(e,n),p=Math.min(t,i)<Math.max(a,r);return!!(d&&g&&m&&p)&&(h=(a-t)*(n-e)-(i-t)*(s-e),o=(r-t)*(n-e)-(i-t)*(c-e),l=(t-a)*(c-s)-(r-a)*(e-s),u=(i-a)*(c-s)-(r-a)*(n-s),h*o<=1e-8&&l*u<=1e-8)},removeThisLine:function(t){for(var e=0,i=0,n=t;n>=0;n--)if(this.trace[n].end){e=n+1;break}for(var a=t;a<this.trace.length;a++)if(this.trace[a].end){i=a;break}this.trace.splice(e,i-e+1),this.rePaint()},eraserTrigger:function(){this.eraserFlag=!this.eraserFlag,this.eraserTrace=[]},image2Canvas:function(t){var e=new Image;e.src=this.imageToInsert,e.onload=function(){this.cxt.drawImage(e,0,0),this.trace.length>0&&t?this.penShapeCompute():this.rePaintTrace()}.bind(this)},drawImageOnCanvas:function(){this.image2Canvas()},imageInput:function(){this.imageInputBtn.click()},traceBackWard:function(){if(0!==this.trace.length){for(var t=!0,e=this.trace.length-2;e>=0;e--)if(!0===this.trace[e].end){this.trace=this.trace.slice(0,e+1),t=!1;break}t&&(this.trace=[]),this.rePaint()}else alert("当前不存在可撤回轨迹")},fileInput:function(){this.fileInputBtn.click()},saveTraceAsJSON:function(){var t=JSON.stringify(this.trace),e=document.createElement("a");e.download="trace.json";var i=new Blob([t]);e.href=URL.createObjectURL(i),e.click(),this.$emit("uploadTraceJSONToFather",t)},eraserTraceInput:function(t,e){this.eraserTrace.push({x:t,y:e})},traceInputBegin:function(t,e,i,n,a){this.trace.push({x:t,y:e,start:i,color:n,width:a})},traceInput:function(t,e,i){this.trace.push({x:t,y:e,end:i})},rePaintTrace:function(){for(var t=!0,e=0;e<this.trace.length;e++)t?(this.beginAndMove(this.trace[e].x,this.trace[e].y),t=!1,this.trace[e].start&&(this.colorChange(this.trace[e].color),this.penSizeChange(this.trace[e].width))):(this.trace[e].end&&(t=!0),this.draw(this.trace[e].x,this.trace[e].y))},rePaint:function(){this.clearCanvas(),this.imageToInsert&&this.drawImageOnCanvas(),this.rePaintTrace()},colorChange:function(t){this.cxt.strokeStyle=t,this.cxt.shadowColor=t},penSizeChange:function(t){var e=Number(t);if(e<=0||e>10||isNaN(e))return console.log("请输入1-10以内的数值"),e=5,void(this.cxt.lineWidth=e);this.cxt.lineWidth=e},imgTypeChange:function(t){this.imageType=t.key},getDOMEl:function(){this.canvas=document.querySelector("#canvas"),this.fileInputBtn=document.querySelector("#fileInputBtn"),this.imageInputBtn=document.querySelector("#imageInputBtn")},canvasSupTest:function(){if(!this.canvas.getContext||!this.canvas.getContext("2d")){var t=document.createElement("section");throw t.className="errorCanvas",t.innerHTML="对不起，当前浏览器不支持canvas",this.canvas.prepend(t),new Error("对不起，当前浏览器不支持canvas")}},porpertyInit:function(){this.canvas.width=this.canvas.clientWidth,this.canvas.height=this.canvas.clientHeight,this.cxt=this.canvas.getContext("2d"),this.cxt.fillStyle=this.canvasBgColor,this.cxt.fillRect(0,0,this.canvas.width,this.canvas.height),this.cxt.strokeStyle=this.lineColor,this.cxt.lineWidth=this.lineWidth,this.cxt.lineCap="round",this.cxt.lineJoin="round",this.cxt.shadowBlur=1,this.cxt.shadowColor=this.lineColor},beginAndMove:function(t,e){this.cxt.beginPath(),this.cxt.moveTo(t,e)},draw:function(t,e){this.cxt.lineTo(t,e),this.cxt.stroke()},close:function(){},download:function(){if("jpg"===this.imageType)var t=this.canvas.toDataURL("image/jpeg",1);else"png"===this.imageType&&(t=this.canvas.toDataURL("image/png"));var e=document.createElement("a");e.href=t,e.download="mySignature",e.click(),this.$emit("uploadImageToFather",t)},clear:function(){this.clearCanvas(),this.image="",this.file="",this.newTrace=[]},clearCanvas:function(){this.cxt.clearRect(0,0,this.canvas.width,this.canvas.height),this.cxt.fillRect(0,0,this.canvas.width,this.canvas.height)},clearTrace:function(){this.trace.splice(0,this.trace.length),this.imageToInsert=""},windowToCanvas:function(){this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight}},components:{},mounted:function(){this.getDOMEl(),this.canvasSupTest(),this.porpertyInit(),this.mobileCompute(),this.isMobile()?(this.canvas.addEventListener("touchstart",function(t){this.eraserFlag||(this.beginAndMove(t.changedTouches[0].pageX-this.minusX,t.changedTouches[0].pageY-this.minusY),this.traceInputBegin(t.changedTouches[0].pageX-this.minusX,t.changedTouches[0].pageY-this.minusY,!0,this.color,this.width))}.bind(this)),this.canvas.addEventListener("touchmove",function(t){this.eraserFlag||(this.traceInput(t.changedTouches[0].pageX-this.minusX,t.changedTouches[0].pageY-this.minusY,!1),this.draw(t.changedTouches[0].pageX-this.minusX,t.changedTouches[0].pageY-this.minusY))}.bind(this)),this.canvas.addEventListener("touchend",function(t){this.eraserFlag||(this.trace.length>0&&this.traceInput(t.changedTouches[0].pageX-this.minusX,t.changedTouches[0].pageY-this.minusY,!0),this.draw(t.changedTouches[0].pageX-this.minusX,t.changedTouches[0].pageY-this.minusY))}.bind(this)),document.body.addEventListener("touchmove",(function(t){t.preventDefault()}),{passive:!1}),this.canvas.addEventListener("touchstart",function(t){this.eraserFlag&&(2===this.eraserTrace.length&&(this.eraserTrace=[]),this.eraserTraceInput(t.changedTouches[0].pageX-this.minusX,t.changedTouches[0].pageY-this.minusY))}.bind(this)),this.canvas.addEventListener("touchend",function(t){this.eraserFlag&&(this.eraserTraceInput(t.changedTouches[0].pageX-this.minusX,t.changedTouches[0].pageY-this.minusY),this.eraserTheLine(),this.eraserTrace=[])}.bind(this))):(this.canvas.addEventListener("mousedown",function(t){this.eraserFlag||(this.traceInputBegin(t.layerX,t.layerY,!0,this.color,this.width),this.beginAndMove(t.layerX,t.layerY),this.flag=!0)}.bind(this)),this.canvas.addEventListener("mousemove",function(t){!this.eraserFlag&&this.flag&&(this.traceInput(t.layerX,t.layerY,!1),this.draw(t.layerX,t.layerY))}.bind(this)),this.canvas.addEventListener("mouseout",function(t){this.flag=!1}.bind(this)),this.canvas.addEventListener("mouseup",function(t){this.eraserFlag||(this.trace.length>0&&this.traceInput(t.layerX,t.layerY,!0),this.flag=!1,this.draw(t.layerX,t.layerY))}.bind(this)),this.canvas.addEventListener("mousedown",function(t){this.eraserFlag&&(2===this.eraserTrace.length&&(this.eraserTrace=[]),this.eraserTraceInput(t.layerX,t.layerY))}.bind(this)),this.canvas.addEventListener("mouseup",function(t){this.eraserFlag&&(this.eraserTraceInput(t.layerX,t.layerY),this.eraserTheLine(),this.eraserTrace=[])}.bind(this))),window.addEventListener("resize",function(){this.porpertyInit(),this.rePaint()}.bind(this)),this.fileInputBtn.addEventListener("change",function(t){this.file=t.target.files;var e=new FileReader;e.readAsText(this.file[0]),e.onload=function(){this.newTrace=JSON.parse(e.result),this.trace=this.trace.concat(this.newTrace)}.bind(this)}.bind(this)),this.fileInputBtn.addEventListener("click",(function(t){this.value=""})),this.imageInputBtn.addEventListener("change",function(t){this.image=t.target.files;var e=new FileReader;e.readAsDataURL(this.image[0]),e.onload=function(t){this.imageToInsert=t.target.result,this.drawImageOnCanvas(),console.log(this.imageToInsert)}.bind(this)}.bind(this)),this.imageInputBtn.addEventListener("click",(function(t){this.value=""}))}}),r=s,c=(i("6c2b"),i("735b"),i("2877")),h=Object(c["a"])(r,n,a,!1,null,"1d0eeee7",null);e["default"]=h.exports}}]);
//# sourceMappingURL=chunk-729f1aa4.94668dd7.js.map